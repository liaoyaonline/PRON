# 系统实现梳理
## 个性化推荐模块
### 数据集预处理
\section{数据集预处理}
下载MySql保存的小说数据集中最近加入书架的小说180本，对每本小说人为添加特征，小说章节数目，小说已看章节数目。移除部分明显对小说分类无影响的特征，将新的数据集重新加入MySql数据库。
其表格如表\ref{tab:bookinfo2}所示:
\begin{table}[H]
	\caption{第一次处理后的存储的书本信息}
	\label{tab:bookinfo2}
	\centering
	\begin{tabular}{l l l}
		\toprule
		\tabhead{存储名} & \tabhead{存储格式} & \tabhead{解释} \\
		\midrule
		BookId & varchar(100) NOT NULL PRIMARY KEY& 主键，用于唯一识别书本\\
		BookWordCount & varchar(100) DEFAULT NULL & 书本字数\\
		BookScore & float(3,1) DEFAULT NULL & 书本评分\\
		BookScoreCount & int(7) DEFAULT NULL & 书本评分人数\\
		OneStarRate & float(3,2) DEFAULT NULL & 一星评分占比\\
		TwoStarRate & float(3,2) DEFAULT NULL & 二星评分占比\\
		ThreeStarRate & float(3,2) DEFAULT NULL & 三星评分占比\\
		FourStarRate & float(3,2) DEFAULT NULL & 四星评分占比\\
		FiveStarRate & float(3,2) DEFAULT NULL & 五星评分占比\\
		AddListCount & int(7) DEFAULT NULL & 加入书单数\\
		BookChapterCount & int(7) DEFAULT NULL & 书本章节总数\\
		BookChapterHaveRead & int(7) DEFAULT NULL & 书本已阅读章节数目\\
		\bottomrule\\
	\end{tabular}
\end{table}
{计算类型}
小说喜好程度以通过章节总数与已阅读章节数目得出，其计算公式如下:
\begin{equation}
S = \frac{X_{1}}{X_{2}}\cdot \frac{2}{\pi}\cdot \arctan(0.04\cdot X_{2})
\label{eqn:Class}
\end{equation}
其中，X是已读章节，Y是章节总数，S为个人根据阅读进度和书本大小对这本书的评分。对于类别评分，根据
方差公式引用，计算出将其划分为两类使其方差和最小，其评分的划分点为0.5547。
将类别划分为两类，其代码为：
\begin{table}[H]
	\begin{lstlisting}
	int Calculation_Class(int BookChapter,int BookChapterHaveRead)
	{
		int flag = 0;
		double pai = 3.1415926;
		double x_tmp = (double)BookChapterHaveRead / (double)BookChapter;
		double y_tmp = 2/pai * atan(0.04* BookChapter);
		double z_tmp = x_tmp * y_tmp;
		if(z_tmp > 0.5547)
		flag = 1;
		return flag;
	}
	\end{lstlisting}
\end{table}
{计算峰度}
峰度衡量数据分布的平坦度（flatness）。尾部大的数据分布，其峰度值较大。正态分布的峰度值为3。计算一星评分占比，二星评分占比,\ldots,五星评分占比的峰度，计算公式如公式:
相应代码如下：
\begin{table}[H]
\begin{lstlisting}
float Calculation_Kurtosis(float StarRate[])//峰度
{
	float K = 0;
	float molecular = 0;
	float Denominator = Calculation_StandardDeviation(StarRate);
	float Average_tmp = Calculation_Average(StarRate);
	for(int i = 0; i < 5; i++)
	{
		float Num_tmp = (StarRate[i] - Average_tmp);
		molecular += (Num_tmp * Num_tmp * Num_tmp * Num_tmp);
	}
	Denominator = (Denominator * Denominator * Denominator * Denominator);
	if(Average_tmp < 0.0001)
		K = 0;
	else
		K = molecular / Denominator;
	return K;
}
\end{lstlisting}
\end{table}
{计算四分位数}
计算一星评分占比，二星评分占比,\ldots,五星评分占比的四分位数，计算公式如公式:

相应代码如下：
\begin{table}[H]
	\begin{lstlisting}
float Calculation_Quartile(float StarRate[])//四分位数
{
	float SumRate_tmp = 0;
	int Q1 = 2;
	int Q3 = 10;
	for(int i = 0; i < 5; i++)
	{
		float Score_tmp = (i + 1) * 2;
		if(SumRate_tmp < 0.25)
		{
			SumRate_tmp += StarRate[i];
			Q1 = Score_tmp;
		}
	}
	SumRate_tmp = 0;
	for(int i = 4; i >= 0; i--)
	{
		float Score_tmp = (i + 1) * 2;
		if(SumRate_tmp < 0.25)
		{
			SumRate_tmp += StarRate[i];
			Q3 = Score_tmp;
		}
	}
	return Q3 - Q1;
}
	\end{lstlisting}
\end{table}

\subsection{计算标准偏差}
计算一星评分占比，二星评分占比,\ldots,五星评分占比的峰度，计算公式如公式:

相应代码如下：
\begin{table}[H]
	\begin{lstlisting}
	float Calculation_StandardDeviation(float StarRate[])//标准偏差
	{
		float Average_tmp = 0;
		float StandardDeviation = 0;
		for(int i = 0; i < 5; i++)
		{
			float Score_tmp = (i + 1) * 2;
			Average_tmp += (StarRate[i] * Score_tmp);
		}
		for(int i = 0; i < 5; i++)
		{
			float Score_tmp = (i + 1) * 2;
			StandardDeviation += ((Score_tmp - Average_tmp) * (Score_tmp - Average_tmp) * StarRate[i]);
		}
		if(StandardDeviation <= 0.0001)
			StandardDeviation = 0;
		else
			StandardDeviation = sqrt(StandardDeviation);
		return StandardDeviation;
	}
	\end{lstlisting}
\end{table}
\subsection{计算中位数}
计算一星评分占比，二星评分占比,\ldots,五星评分占比的峰度，计算公式如公式:

相应代码如下：
\begin{table}[H]
	\begin{lstlisting}
	float Calculation_Median(float StarRate[])//计算中位数
	{
		float SumRate_tmp = 0;
		int SumRateflag_tmp = 0;
		for(int i = 0; i< 5; i++)
		{
			if(SumRate_tmp < 0.5)
			{
				SumRate_tmp += StarRate[i];
				SumRateflag_tmp = i;
			}
		}
		return (SumRateflag_tmp+1) * 2;
	}
	\end{lstlisting}
\end{table}
\subsection{计算众数}
计算一星评分占比，二星评分占比,\ldots,五星评分占比的峰度，计算公式如公式:

相应代码如下：
\begin{table}[H]
	\begin{lstlisting}
	float Calculation_Mode(float StarRate[])
	{
		float MaxRate_tmp = 0;
		int MaxRateflag_tmp = 0;
		for(int i = 0; i < 5; i++)
		{
			if(StarRate[i] >= MaxRate_tmp)
			{
				MaxRate_tmp = StarRate[i];
				MaxRateflag_tmp = i;
			}
		}
		return (MaxRateflag_tmp+1) * 2;
	}
	\end{lstlisting}
\end{table}
将取到的特征信息存入MySql数据库，其内容如下表所示
\begin{table}[H]
	\caption{预处理后的存储的书本信息}
	\label{tab:bookinfo3}
	\centering
	\begin{tabular}{l l l}
		\toprule
		\tabhead{存储名} & \tabhead{存储格式} & \tabhead{解释} \\
		\midrule
		BookId & varchar(100) NOT NULL PRIMARY KEY& 主键，用于唯一识别书本\\
		BookWordCount & float(3,2) DEFAULT NULL & 书本字数\\
		BookScore & float(3,1) DEFAULT NULL & 书本评分\\
		BookScoreCount & int(7) DEFAULT NULL & 书本评分人数\\
		AddListCount & int(7) DEFAULT NULL & 加入书单数\\
		OneStarRate & float(3,2) DEFAULT NULL & 一星评分占比\\
		TwoStarRate & float(3,2) DEFAULT NULL & 二星评分占比\\
		ThreeStarRate & float(3,2) DEFAULT NULL & 三星评分占比\\
		FourStarRate & float(3,2) DEFAULT NULL & 四星评分占比\\
		FiveStarRate & float(3,2) DEFAULT NULL & 五星评分占比\\
		Mode & int(7) DEFAULT NULL & 各星级评分众数\\
		Median & int(7) DEFAULT NULL & 各星级评分中位数\\
		StandardDeviation & float(3,2) DEFAULT NULL & 各星级评分标准偏差\\
		Quartile & float(3,2) DEFAULT NULL & 各星级评分四分位数\\
		DispersionCoefficient & float(3,2) DEFAULT NULL & 各星级评分离散系数\\
		Kurtosis & float(3,2) DEFAULT NULL & 各星级评分峰度\\
		Class & varchar(100) NOT NULL & 书本类别\\
		\bottomrule\\
	\end{tabular}
\end{table}


### 特征值重要性分析
根据Gini Importance对每个特征划分能力进行排序，参考章节（引用相关知识特征重要性排序)。采用加权线性累加，计算每个特征在每次划分时减少
的Gini值，权重为划分后的样本数量和总样本数量的比值。
划分能力是指每次使用某个特征对数据集进行划分，其减少的Gini值，进行次序。
其每个特征的划分能力排序如下表所示:(表，稍后制作，增加编码)
其划分能力如图所示：（图条形图稍后制作）
\begin{table}[H]
	\caption{特征Gini Importance}
	\label{tab:Feature1}
	\centering
	\begin{tabular}{l l l}
		\toprule
		\tabhead{特征名} & \tabhead{Gini Importance} & \tabhead{编码} \\
		\midrule
		BookScoreCount & 0.333878 & 101\\
		BookWordCount & 0.303971 & 102\\
		AddListCount & 0.297159 & 103\\
		Kurtosis & 0.263036 & 104\\
		StandardDeviation & 0.261233 & 105\\
		ThreeStarRate & 0.259227 & 106\\
		FiveStarRate & 0.252293 & 107\\
		FourStarRate & 0.247871 & 108\\
		BookScore & 0.246668 & 109\\
		DispersionCoefficient & 0.227262 & 110\\
		OneStarRate & 0.218227 & 111\\
		TwoStarRate & 0.176709 & 112\\
		Median & 0.126521 & 113\\
		Mode & 0.124782 & 114\\
		Quartile & 0.0875916 & 115\\
		\bottomrule\\
	\end{tabular}
\end{table}
其对应图形如图所示:
\begin{figure}[H]
	\centering
	\includegraphics{Figures/Feature_GiniImportance.png}
	\decoRule
	\caption{Features GiniImportance}
	\label{fig:FeatureGiniImportance}
\end{figure}
由上图可以看出，BookScoreCount,BookWordCount,AddListCount具有较好的分类能力。Quartile具有较差的分类能力。
### BootStrapping自取样
### 构建随机森林模型
### 个性化推荐
1、每日推荐界面
每日推荐界面如图所示。
2、业务逻辑实现
每日推荐会调用建立好的随机森林模型对数据库中不在书架上的小说进行分类，一直到分类为好的小说数目达到10，将小说信息提交到web界面显示出来。
## 登录注销模块
1、登录界面
登录界面由两个文本框、一个下拉列表框和两个按钮构成。两个文本框一个
用于输入用户名,另一个用于输入密码。下拉列表框用于选择登录用户的角色,
本系统中有操作员和管理员两个角色。两个按钮一个用于提交登录信息,一个用
于取消登录。登录界面如图5-1所示。管理员登录成功后的界面如图5-2所示。普
通业务员进入的操作界面如图5-3所示。
2、业务逻辑实现
当 用 户输入登录信 息后 ,在客户端首先进行非空验证,具体由相应的
Javascript 客户端脚本代码实现。用户点击“确定”按钮,触发了该按钮的 Click
事件,从而由表示层对象调用业务逻辑层对象 LoginUserBLL 的验证登录信息
方法 IsLogin()函数的功能。同时也要判断当前登录用户角色是操作员还是管
理员。
## 书架管理模块
1、界面的实现
添加书架界面如图 5-4 所示。
2、业务逻辑实现
添加书架功能由书架管理类BookshelfMageBLL中的添加方法addbookshelf()完
成。在添加书架时,需要对那些标注为必填项的区域中一定要输入相关信息,
否则会提示出错。对必填项的判断可以通过客户端验证实现,这样可以减少服务
器端的验证处理时间,减轻服务器端的压力。填完后点击“确定”按钮向系统提交新的书架信息。系统后台通过执行SQL语句中的INSERT语句就可以保存新的
书架信息。
1、界面实现
修改书架界面如图 5-5 所示。
2、业务逻辑实现
在进入修改书架界面时，选择要修改的书架，然后输入新的书架名，介绍，标签。修改书架功能由书架管理模块BookshellMageBLL中的修改方法updatebookshelf()完成。在用户修改书架信息时，需要对那些标注为必填项的区域中一定要输入相关信息，否则会提示出错。对必填项的判断可以通过客户端验证实现,这样可以减少服务器端的验证处理时间,减轻服务器端的压力。填完后点击“确定”按钮向系统提交新的书架信息。系统后台通过执行SQL语句中的INSERT语句就可以保存新的书架信息。
1、界面实现
删除书架界面如图 5-5 所示。
2、业务逻辑实现
在进入删除书架界面时，选择要删除的书架，然后点击确定。删除书架功能由书架管理模块BookshellMageBLL中的修改方法deletebookshelf()完成。填完后点击“确定”按钮向系统提交删除书架申请。系统后台通过执行SQL语句中的DELETE语句就可以删除书架信息。

## 书单管理模块
1、界面的实现
添加书单界面如图 5-4 所示。
2、业务逻辑实现
添加书单功能由书单管理类BooklistMageBLL中的添加方法addbooklist()完
成。在添加书单时,需要对那些标注为必填项的区域中一定要输入相关信息,
否则会提示出错。对必填项的判断可以通过客户端验证实现,这样可以减少服务
器端的验证处理时间,减轻服务器端的压力。填完后点击“确定”按钮向系统提交新的书单信息。系统后台通过执行SQL语句中的INSERT语句就可以保存新的
书架信息。
1、界面实现
修改书单界面如图 5-5 所示。
2、业务逻辑实现
在进入修改书单界面时，选择要修改的书单，然后输入新的书单名，介绍，标签。修改书单功能由书架管理模块BooklistMageBLL中的修改方法updatebooklist()完成。在用户修改书单信息时，需要对那些标注为必填项的区域中一定要输入相关信息，否则会提示出错。对必填项的判断可以通过客户端验证实现,这样可以减少服务器端的验证处理时间,减轻服务器端的压力。填完后点击“确定”按钮向系统提交新的书单信息。系统后台通过执行SQL语句中的INSERT语句就可以保存新的书单信息。
1、界面实现
删除书单界面如图 5-5 所示。
2、业务逻辑实现
在进入删除书单界面时，选择要删除的书架，然后点击确定。删除书单功能由书架管理模块BooklistMageBLL中的修改方法deletebooklist()完成。填完后点击“确定”按钮向系统提交删除书单申请。系统后台通过执行SQL语句中的DELETE语句就可以删除书单信息。
## 检索管理模块
